/**
 * Posting module
 *
 * Encompasses posting & commenting forms
 */

fieldset {
  @include extend('%reset-all');
}

// Completely revamp posting form

// NOTE: ANIMATIONS DO NOT WORK DUE TO DYNAMICALLY INSERTED HTML
//       CODE LEFT AS REFERENCE

// ANIMATION CODE
// // To facilitate the enter/exit animations, we make the modal wrapper visible on the DOM level at
// // all times, but invisible to user actions…
// .aops-modal-wrapper {
//   display: block !important;
//   pointer-events: none;
//
//   // …until the modal is open.
//   .aops-modal-open & {
//     pointer-events: all;
//   }
// }

// Styling the actual modal itself
.cmty-posting-modal {
  @include extend('%border-box');

  border-width: 1.8rem;
  border-color: $bgGeneral;
  box-shadow: 0 0 10% $fgGeneral;

  // Make modal full-screen
  max-width: 100% !important;
  max-height: 100% !important;

  // Overwrite EvDo modal positioning hack
  transform: none !important;

  // ANIMATION CODE
  // Animate modal to slide in from bottom
  // transform: translateY(110%) !important;
  // transition: transform $transitionDuration ease;

  @include position(0 !important,
                    0 !important,
                    0 !important,
                    0 !important);
  @include dimensions(100% !important,
                      100% !important);

  // ANIMATION CODE
  // .aops-modal-open & {
  //   transform: translateY(0) !important;
  // }
  //
  // // Fade in the modal's contents
  // .aops-modal-content-wrapper {
  //   opacity: 0;
  //
  //   transition: opacity $transitionDuration $transitionDuration ease;
  //
  //   .aops-modal-open & {
  //     opacity: 1;
  //   }
  // }

  // Style the close button as line-art
  .aops-close-x {
    @include extend('%content-box');
    @include position(-32px, null, -32px);

    color: $fgSub;
    background-color: $t;

    padding: 6px;
    border-radius: 0;

    &::before,
    &::after {
      @include extend('%pseudo');

      background-color: invert($fgSub);

      transform: rotate(45deg);

      @include position(18px, 3px);
      @include dimensions(21px, 1px);
    }
    &::after {
      transform: rotate(-45deg);
    }
  }

  // Style faux-placeholders
  .cmty-heading-text {
    @include extend('%heading');

    position: absolute;

    opacity: 0;
    color: $fgSub;
    font-size: inherit;
  }
}

// Flash faux-placeholder fields, then fade
//
// Subject: Flash 3 times
// Tags: Flash 1 time
// Body: Flash 2 times
@keyframes flash-post-subject {
  0%   { opacity: 1 }
  5%   { opacity: 1 }
  20%  { opacity: 0.5 }
  27%  { opacity: 1 }
  42%  { opacity: 0.5 }
  49%  { opacity: 1 }
  64%  { opacity: 0.5 }
  71%  { opacity: 1 }
  100% { opacity: 0 }
}
@keyframes flash-post-tags {
  0%   { opacity: 1 }
  49%  { opacity: 1 }
  64%  { opacity: 0.5 }
  71%  { opacity: 1 }
  100% { opacity: 0 }
}
@keyframes flash-post-body {
  0%   { opacity: 1 }
  27%  { opacity: 1 }
  42%  { opacity: 0.5 }
  49%  { opacity: 1 }
  64%  { opacity: 0.5 }
  71%  { opacity: 1 }
  100% { opacity: 0 }
}

// Subject
.cmty-posting-subject-line {
  position: relative;

  font-size: 2.5em;
  padding: 10px 0;

  // Style faux-placeholder
  .cmty-heading-text {
    margin: 0.3em 0.2em;

    animation: flash-post-subject $postingAnimationDuration ease;
  }

  // Style text input
  .cmty-subject-input {
    @include extend('%heading');

    position: relative;

    background-color: $t !important;
    padding-left: 0.2em;

    // Cover up the faux-placeholder for #{$transitionDuration} after focus
    // This is to prevent the placeholder from showing behind any user-entered text
    transition: background-color $transitionDuration $postingAnimationDuration ease,
                border-color $transitionDuration ease;

    @include dimensions(100%, 2em);

    &:focus {
      background-color: $bgGeneral !important;
      padding-left: 0.2em;

      // Make sure the transition to the focus state is snappy
      transition: background-color $transitionDuration 0s ease,
                  border-color $transitionDuration ease;
    }
  }

  // Remove the forum context
  .cmty-post-in {
    display: none;
  }
}

// Tags
.cmty-tags-line {
  padding: 0;

  // Again, the faux-placeholder
  .cmty-heading-text {
    text-align: left;
    margin: 0.2em;

    animation: flash-post-tags $postingAnimationDuration ease;
  }

  // Reset a few AoPS styles
  .cmty-items-input-box {
    background-color: $t;

    padding: 0;
    border: none;
  }

  // The tags input box
  // Dear AoPS devs: the world is a better place w/o !important. Don't use it and I won't either :)
  .cmty-items-input {
    @include extend('%heading');

    background-color: $t !important;

    padding: 0.3em 0.2em !important;
    margin-bottom: 0.5em;

    transition: background-color $transitionDuration $postingAnimationDuration ease,
                border-color $transitionDuration ease;

    /* Following styles copied from text inputs; see general.scss */
    border-width: 0 0 1px !important;
    border-style: solid !important;
    border-color: $bgSub5 !important;

    &:hover {
      border-color: $bgSub !important;
    }
    &:focus {
      background-color: $bgGeneral !important;
      padding: 0.3em 0.2em !important;
      border-color: $fgSub !important;

      transition: background-color $transitionDuration 0s ease,
                  border-color $transitionDuration ease;
    }
  }
}

// Compostion
// Placeholder for splitting the view into composition and preview areas
%posting-split {
  width: 50%;
  height: calc(100% - 10.9rem) !important;

  .cmty-edit-post & {
    height: calc(100% - 8.5rem) !important;
  }
}

.cmty-posting-box-container {
  @include extend('%posting-split');

  float: left;

  // Create a faux-placeholder from pseudo-elements
  &::before {
    @include extend('%heading');

    content: "Message";
    position: absolute;

    opacity: 0;
    color: $fgSub;
    font-size: 1.2em;

    margin: 0.3em;

    animation: flash-post-body $postingAnimationDuration ease;
  }

  .cmty-post-textarea {
    position: relative;

    background-color: $t;
    padding: 0.5em 0.3em;
    border: none;

    transition: background-color $transitionDuration $postingAnimationDuration ease;

    &:focus {
      background-color: $bgGeneral;
      padding: 0.5em 0.3em;
      border: none;

      transition: background-color $transitionDuration 0s ease;
    }
  }
}

.cmty-post-preview {
  @include extend('%posting-split');

  display: block !important;
  float: right;

  border-left: 1px solid $bgSub5;
}

.cmty-posting-preview-bar {
  position: fixed;
  left: -100%;

  // Change colour scheme of preview bar
  background-color: $bgGeneral;
  color: $fgGeneral;

  // Always hide the "open preview" action
  .cmty-posting-preview-bar-hidden {
    display: none !important;
  }

  // Always show the "preview is open" actions"
  .cmty-posting-preview-bar-shown {
    display: block !important;
  }

  // Position "refresh preview" and "view attachments" buttons below the composition areas
  .cmty-refresh-preview,
  .cmty-preview-bar-attachments {
    position: fixed;
    bottom: 0;

    font-size: 0.8rem;
    padding: 0.5em;
    margin: 0;
  }

  .cmty-refresh-preview {
    z-index: 1;

    border-top: 1px solid $bgSub5;

    left: 1.8rem;
    right: 1.8rem;
  }

  .cmty-preview-bar-attachments {
    z-index: 10;

    left: 1.5rem;
  }
}

// Extend message styles to preview box
.cmty-post-preview-text {
  @include extend('.message');

  // Fix font in preview box
  font-family: Merriweather, Garamond, times, serif;
}

// Buttons
// Reset colour scheme of buttons
.cmty-posting-top,
.cmty-posting-button-row {
  color: $fgGeneral;

  @include reset(background);
}

// Fix positioning of buttons
.cmty-posting-environ-buttons .btn {
  vertical-align: top;
}

// Change colour of BBCode overflow button
.cmty-bbcode-btn {
  color: $fgGeneral;
}

// Replies
.blog-reply-window {
  @include extend('%modal-font');

  // Cover up the "Comment" link (useless — clicking on it results in no action)
  position: relative;
  z-index: 1;
  background-color: $bgGeneral;

  // Hide comment reply window (inline styles prevent this)
  display: none !important;

  padding: 0 1em;
  border: 1px solid $bgSub5;

  // Overwrite last style and show when open
  &.blog-reply-open {
    display: block !important;
  }

  // Clearfix to prevent comment link from affecting the comment reply window
  &.blog-reply-open::before {
    content: "";
    display: table;
    clear: both;
  }

  // Change faux-placeholder message to a more context-appropriate one
  .cmty-posting-box-container::before {
    content: "Comment"
  }

  // Align action buttons with the "Comment" link
  .cmty-posting-environ {
    top: -2.1em;
    z-index: 1;
    margin-bottom: -2.1em;
  }

  // Reset the colour scheme of the buttons bar
  .cmty-posting-button-row {
    background-color: $bgGeneral;
  }

  .cmty-cancel-posting-x {
    color: $fgGeneral;
  }

  // Align submit button to the left
  .cmty-submit-button {
    float: left;
  }

  // Also, introduce extra padding on mobile
  .cmty-posting-button-row.cmty-phone {
    margin-bottom: 1.1em;
  }

  // Remove annoying border from preview box
  .cmty-post-preview {
    border: none;
  }
}
